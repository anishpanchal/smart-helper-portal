{% extends 'base.html' %}
{% load static %}

{% block title %}Study Planner - Smart College Helper Portal{% endblock %}

{% block content %}
<div class="welcome-section">
    <h1 class="welcome-title">
        <i class="fas fa-calendar-alt"></i> AI Study Planner
    </h1>
    <p class="welcome-subtitle">Create personalized study plans for your exams</p>
</div>

<!-- Create Study Plan Form -->
<div class="glass-card" style="margin-bottom: 3rem;">
    <h2 style="margin-bottom: 1.5rem;">
        <i class="fas fa-plus-circle"></i> Create New Study Plan
    </h2>
    <form method="POST" id="study-plan-form">
        {% csrf_token %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-book"></i> Course Name
                </label>
                <input type="text" name="course_name" class="form-input" required placeholder="e.g., Database Management Systems">
            </div>

            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-calendar"></i> Exam Date
                </label>
                <input type="date" name="exam_date" class="form-input" required id="exam_date">
            </div>

            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-clock"></i> Hours per Day
                </label>
                <input type="number" name="hours_per_day" class="form-input" required min="1" max="12" value="3">
            </div>
        </div>

        <button type="submit" class="btn" style="margin-top: 1.5rem;">
            <i class="fas fa-magic"></i> Generate Study Plan
        </button>
    </form>
</div>

<!-- Existing Study Plans -->
{% if study_plans %}
<div class="glass-card">
    <h2 style="margin-bottom: 1.5rem;">
        <i class="fas fa-list"></i> Your Study Plans
    </h2>

    {% for plan in study_plans %}
    <div class="study-plan-card">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div>
                <h3 style="margin-bottom: 0.5rem;">{{ plan.course_name }}</h3>
                <p style="color: var(--text-secondary);">
                    <i class="fas fa-calendar"></i> Exam Date: {{ plan.exam_date }}
                </p>
                <p style="color: var(--text-secondary);">
                    <i class="fas fa-clock"></i> {{ plan.hours_per_day }} hours/day
                </p>
            </div>
            <span class="badge {% if plan.is_completed %}badge-success{% else %}badge-warning{% endif %}">
                {% if plan.is_completed %}Completed{% else %}In Progress{% endif %}
            </span>
        </div>

        <div style="margin-top: 1.5rem;">
            <h4 style="margin-bottom: 1rem;">Study Schedule:</h4>
            <div style="max-height: 300px; overflow-y: auto;">
                {% for day in plan.plan_data %}
                <div class="plan-day">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong>Day {{ day.day }} - {{ day.phase }}</strong>
                        <small style="color: var(--text-secondary);">{{ day.date }}</small>
                    </div>
                    <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                        {% for task in day.tasks %}
                        <li>{{ task }}</li>
                        {% endfor %}
                    </ul>
                    <small style="color: var(--text-secondary);">
                        <i class="fas fa-clock"></i> {{ day.hours }} hours
                    </small>
                </div>
                {% endfor %}
            </div>
        </div>

        <small style="color: var(--text-secondary); display: block; margin-top: 1rem;">
            Created: {{ plan.created_at|date:"M d, Y" }}
        </small>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="glass-card" style="text-align: center; padding: 3rem;">
    <i class="fas fa-calendar-plus" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;"></i>
    <h3>No study plans yet</h3>
    <p style="color: var(--text-secondary);">Create your first study plan above!</p>
</div>
{% endif %}

<script>
    // Set minimum date to today
    document.addEventListener('DOMContentLoaded', function() {
        const examDateInput = document.getElementById('exam_date');
        if (examDateInput) {
            const today = new Date().toISOString().split('T')[0];
            examDateInput.setAttribute('min', today);
        }
    });
</script>
{% endblock %}